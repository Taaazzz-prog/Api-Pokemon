<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔌 Test Mode Hors Ligne</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            min-height: 100vh;
            color: white;
        }
        .offline-test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            margin: 5px;
        }
        .status-online {
            background: #2ecc71;
            color: white;
        }
        .status-offline {
            background: #e74c3c;
            color: white;
        }
        .status-fallback {
            background: #f39c12;
            color: white;
        }
        .test-button {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .pokemon-count {
            font-size: 24px;
            font-weight: bold;
            color: #f39c12;
            text-align: center;
            margin: 20px 0;
        }
        .fallback-list {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .fallback-pokemon {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            margin: 3px;
            border-radius: 15px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="offline-test-container">
        <h1>🔌 Test Mode Hors Ligne</h1>
        
        <div class="test-section">
            <h2>📊 État des Connexions</h2>
            <div id="connection-status">
                <span class="status-indicator" id="network-status">🌐 Vérification...</span>
                <span class="status-indicator" id="api-status">📡 Vérification...</span>
                <span class="status-indicator" id="fallback-status">📦 Vérification...</span>
            </div>
        </div>

        <div class="test-section">
            <h2>📦 Données de Fallback</h2>
            <div class="pokemon-count" id="fallback-count">0 Pokémon</div>
            <div class="fallback-list" id="fallback-list"></div>
        </div>

        <div class="test-section">
            <h2>🧪 Tests de Fonctionnement</h2>
            <button class="test-button" onclick="testFallbackData()">📦 Tester Données Fallback</button>
            <button class="test-button" onclick="testOfflineMode()">🔌 Simuler Mode Hors Ligne</button>
            <button class="test-button" onclick="testApiConnection()">📡 Tester Connexion API</button>
            <div id="test-results"></div>
        </div>

        <div class="test-section">
            <h2>🎯 Navigation Test</h2>
            <button class="test-button" onclick="window.location.href='liste.html'">📋 Tester Pokédex</button>
            <button class="test-button" onclick="window.location.href='generation.html'">🔢 Tester Générations</button>
            <button class="test-button" onclick="window.location.href='demo.html'">🎉 Retour Démo</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="pokemon-fallback-data.js"></script>
    
    <script>
        // Vérifier l'état au chargement
        window.addEventListener('DOMContentLoaded', function() {
            checkConnectionStatus();
            displayFallbackData();
        });

        function checkConnectionStatus() {
            const networkStatus = document.getElementById('network-status');
            const apiStatus = document.getElementById('api-status');
            const fallbackStatus = document.getElementById('fallback-status');

            // Vérifier la connexion réseau
            if (navigator.onLine) {
                networkStatus.textContent = '🌐 En Ligne';
                networkStatus.className = 'status-indicator status-online';
            } else {
                networkStatus.textContent = '🌐 Hors Ligne';
                networkStatus.className = 'status-indicator status-offline';
            }

            // Vérifier l'API
            testApiConnection().then(result => {
                if (result) {
                    apiStatus.textContent = '📡 API Accessible';
                    apiStatus.className = 'status-indicator status-online';
                } else {
                    apiStatus.textContent = '📡 API Inaccessible';
                    apiStatus.className = 'status-indicator status-offline';
                }
            });

            // Vérifier les données de fallback
            if (window.pokemonFallbackData && window.pokemonFallbackData.length > 0) {
                fallbackStatus.textContent = '📦 Fallback Disponible';
                fallbackStatus.className = 'status-indicator status-fallback';
            } else {
                fallbackStatus.textContent = '📦 Fallback Manquant';
                fallbackStatus.className = 'status-indicator status-offline';
            }
        }

        function displayFallbackData() {
            const countElement = document.getElementById('fallback-count');
            const listElement = document.getElementById('fallback-list');

            if (window.pokemonFallbackData) {
                countElement.textContent = `${window.pokemonFallbackData.length} Pokémon`;
                
                const pokemonList = window.pokemonFallbackData.map(p => 
                    `<span class="fallback-pokemon">#${p.id} ${p.name}</span>`
                ).join('');
                
                listElement.innerHTML = pokemonList;
            } else {
                countElement.textContent = '0 Pokémon';
                listElement.innerHTML = '<p>❌ Aucune donnée de fallback trouvée</p>';
            }
        }

        async function testApiConnection() {
            try {
                const response = await fetch('https://pokebuildapi.fr/api/v1/pokemon', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                return true;
            } catch (error) {
                return false;
            }
        }

        function testFallbackData() {
            const resultsDiv = document.getElementById('test-results');
            
            if (window.pokemonFallbackData && window.pokemonFallbackData.length > 0) {
                const testPokemon = window.pokemonFallbackData[0];
                resultsDiv.innerHTML = `
                    <div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <h3>✅ Test Réussi</h3>
                        <p><strong>Pokémon testé:</strong> ${testPokemon.name} (#${testPokemon.id})</p>
                        <p><strong>Types:</strong> ${testPokemon.apiTypes.map(t => t.name).join(', ')}</p>
                        <p><strong>Génération:</strong> ${testPokemon.apiGeneration}</p>
                        <p><strong>Image:</strong> ${testPokemon.image}</p>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <h3>❌ Test Échoué</h3>
                        <p>Aucune donnée de fallback disponible</p>
                    </div>
                `;
            }
        }

        function testOfflineMode() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `
                <div style="background: rgba(243, 156, 18, 0.2); padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <h3>🔌 Mode Hors Ligne Simulé</h3>
                    <p>Le mode hors ligne est automatiquement activé quand l'API n'est pas accessible.</p>
                    <p><strong>Données disponibles:</strong> ${window.pokemonFallbackData ? window.pokemonFallbackData.length : 0} Pokémon</p>
                    <p><strong>Conseil:</strong> Testez en allant sur les pages Pokédex ou Générations.</p>
                </div>
            `;
        }

        // Écouter les changements de connexion
        window.addEventListener('online', checkConnectionStatus);
        window.addEventListener('offline', checkConnectionStatus);
    </script>
</body>
</html>